"use strict";(self["webpackChunkvue"]=self["webpackChunkvue"]||[]).push([[482],{7488:function(e,l,a){function t(e,l,a){const t=new Date;t.setTime(t.getTime()+24*a*60*60*1e3);const o="expires="+t.toUTCString();document.cookie=e+"="+l+";"+o+";path=/"}function o(e){const l=e+"=",a=decodeURIComponent(document.cookie),t=a.split(";");for(let o=0;o<t.length;o++){let e=t[o];while(" "===e.charAt(0))e=e.substring(1);if(0===e.indexOf(l))return e.substring(l.length,e.length)}return""}function s(e){document.cookie=e+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/;"}function u(){const e=decodeURIComponent(document.cookie),l=e.split(";");return l.length}l.Ay={setCookie:t,getCookie:o,getCookieNum:u,deleteCookie:s}},5210:function(e,l,a){a.r(l),a.d(l,{default:function(){return N}});a(4114);var t=a(6768),o=a(144),s=a(4232),u=a.p+"img/pay.c6c4495d.jpg",n=a(8073),d=a(7488),r=a(1219),c=a(9325);const i={class:"container"},k={class:"left-div"},m={class:"avatar-container"},v=(0,t.Lk)("div",{class:"el-upload__text"},[(0,t.eW)(" 拖拽图片上传或 "),(0,t.Lk)("em",null,"点击这里上传")],-1),p={class:"dialog-footer"},g={class:"right-div"},y=(0,t.Lk)("div",{class:"card-header"},[(0,t.Lk)("span",null,"个人信息")],-1),f={class:"card-content"},b={class:"card-term"},h={class:"card-term"},C={class:"card-term"},F={key:0,class:"card-term"},_={key:1,class:"card-term"},w={class:"card-term"},V={key:0,style:{"margin-left":"5%"}},L={key:1,style:{"margin-left":"5%"}},A={class:"component"},R={class:"component"},U=(0,t.Lk)("div",{class:"card-header"},[(0,t.Lk)("span",null,"账号管理")],-1),W={class:"card-content"},I=(0,t.Lk)("div",{style:{display:"flex","justify-content":"center","align-items":"center"}},[(0,t.Lk)("img",{src:u,style:{height:"50%",width:"50%"}})],-1),K={class:"component"},x={class:"component"},T={class:"component"},E={class:"component"};var M={__name:"UserInfo",setup(e){const l=(0,o.KR)([]),a=(0,o.KR)(!1),u=(0,o.KR)(""),M=(0,o.KR)(""),X=(0,o.KR)(""),N=(0,o.KR)(!1),q=(0,o.KR)(!1),S=((0,o.KR)(""),(0,o.KR)("获取验证码")),j=(0,o.KR)(!1),z=(0,o.KR)(!1),D=(0,o.KR)(!1),H=(0,o.KR)(!1),Q=(0,o.KR)(""),G=(0,o.KR)(""),J=(0,o.KR)(""),O=(0,o.KR)(""),$=(0,o.KR)("");Math.random();const B=(0,o.KR)("*".repeat(d.Ay.getCookie("password").length)),P=()=>{try{const e=d.Ay.getCookie("rememberMe");e||(d.Ay.deleteCookie("userName"),d.Ay.deleteCookie("userId"),d.Ay.deleteCookie("password"),d.Ay.deleteCookie("avatar")),d.Ay.setCookie("ifLogin",!1,3600),D.value=!1,(0,r.nk)({message:"退出成功！",type:"success"}),setTimeout((()=>{c.A.push("/login")}),500)}catch(e){console.error(e),(0,r.nk)({message:"退出失败",type:"warning"})}},Y=async()=>{try{console.log($.value);const e=await n.Ay.get("/user/recharge",{payment:$.value,userId:d.Ay.getCookie("userId")});"recharge success"==e.data.msg&&((0,r.nk)({message:"支付成功！",type:"success"}),setTimeout((function(){location.reload()}),500))}catch(e){(0,r.nk)({message:"支付失败",type:"error"})}},Z=async()=>{""===G.value&&(0,r.nk)({type:"warning",message:"请输入新密码！"}),""===J.value&&(0,r.nk)({type:"warning",message:"请再次输入新密码！"}),""===O.value&&(0,r.nk)({type:"warning",message:"请输入验证码！"}),G.value!==J.value&&(0,r.nk)({type:"warning",message:"两次密码不一致！"});try{const e=await n.Ay.get("/user/modify/password",{userId:d.Ay.getCookie("userId"),password:G.value});console.log(e),(0,r.nk)({message:"密码更新成功！",type:"success"}),setTimeout((function(){location.reload()}),500)}catch(e){console.log(e)}},ee=()=>{j.value=!0,B.value=l.value.password},le=()=>{j.value=!1;const e="*".repeat(B.value.length);B.value=e},ae=()=>{z.value=!0},te=()=>{alert("您的验证码是：1234"),q.value=!0;let e=60;const l=setInterval((()=>{e--,0===e?(clearInterval(l),q.value=!1,S.value="获取验证码"):S.value=`${e}秒后重新获取`}),1e3)},oe=async()=>{try{console.log(d.Ay.getCookie("userId")),console.log(d.Ay.getCookie("password")),console.log(M.value);const e=await n.Ay.post("/user/set/email",{userId:d.Ay.getCookie("userId"),password:d.Ay.getCookie("password"),userName:d.Ay.getCookie("userName"),email:M.value});if(console.log(e),"same email"===e.data.msg)return void(0,r.nk)({message:"请输入与之前不同的邮箱！",type:"warning"});if("validate identity failed"===e.data.msg)return void(0,r.nk)({message:"身份验证失效；请重新登陆",type:"warning"});if("set email success!"!==e.data.msg)return void console.log(e);(0,r.nk)({type:"success",message:"绑定成功！"}),setTimeout((function(){location.reload()}),500),console.log(e)}catch(e){console.error(e),(0,r.nk)({type:"warning",message:"绑定失败！"})}},se=async(e,l)=>{if(e.raw){const l=new FormData;l.append("avatar",e.raw),l.append("userId",d.Ay.getCookie("userId"));try{const e=await n.Ay.fileUpload("user/update/avatar",l);u.value=e.data.imageUrl,console.log(u),(0,r.nk)({message:"上传成功！",type:"success"}),setTimeout((function(){location.reload()}),500)}catch(a){(0,r.nk)({message:"上传失败！",type:"warning"})}}};return(0,t.sV)((async()=>{try{const e=await n.Ay.get("/user/select/userId",{userId:d.Ay.getCookie("userId")});l.value=e.data,console.log(e),console.log(l),console.log(n.Ay.getServerUrl()+l.value.avatar)}catch(e){console.error(e)}})),(e,u)=>{const d=(0,t.g2)("el-avatar"),r=(0,t.g2)("upload-filled"),c=(0,t.g2)("el-icon"),ue=(0,t.g2)("el-upload"),ne=(0,t.g2)("el-button"),de=(0,t.g2)("el-dialog"),re=(0,t.g2)("User"),ce=(0,t.g2)("Money"),ie=(0,t.g2)("InfoFilled"),ke=(0,t.g2)("Message"),me=(0,t.g2)("Lock"),ve=(0,t.g2)("Hide"),pe=(0,t.g2)("View"),ge=(0,t.g2)("el-input"),ye=(0,t.g2)("el-card");return(0,t.uX)(),(0,t.Wv)(ye,null,{default:(0,t.k6)((()=>[(0,t.Lk)("div",i,[(0,t.Lk)("div",k,[(0,t.Lk)("div",m,[(0,t.Lk)("div",null,[(0,t.bF)(d,{size:200,class:"avatar",src:(0,o.R1)(n.Ay).getServerUrl()+l.value.avatar,onClick:u[0]||(u[0]=e=>a.value=!0)},null,8,["src"]),(0,t.Lk)("div",{style:{"font-size":"20px","margin-top":"15px",cursor:"pointer",color:"#25a4bb"},onClick:u[1]||(u[1]=e=>a.value=!0)},"点此处或图片更换头像"),(0,t.bF)(de,{modelValue:a.value,"onUpdate:modelValue":u[3]||(u[3]=e=>a.value=e),title:"更换头像"},{footer:(0,t.k6)((()=>[(0,t.Lk)("div",p,[(0,t.bF)(ne,{onClick:u[2]||(u[2]=e=>a.value=!1)},{default:(0,t.k6)((()=>[(0,t.eW)("取消更换")])),_:1})])])),default:(0,t.k6)((()=>[(0,t.bF)(ue,{class:"upload-demo",action:"http://localhost:1145/user/update/avatar","file-list":e.fileList,"on-change":se,"http-request":e.customHttpRequest,multiple:"",drag:"",limit:3,"on-exceed":e.handleExceed,"auto-upload":!1},{default:(0,t.k6)((()=>[(0,t.bF)(c,{class:"el-icon--upload"},{default:(0,t.k6)((()=>[(0,t.bF)(r)])),_:1}),v])),_:1},8,["file-list","http-request","on-exceed"])])),_:1},8,["modelValue"])])])]),(0,t.Lk)("div",g,[(0,t.bF)(ye,{class:"userCard"},{header:(0,t.k6)((()=>[y])),default:(0,t.k6)((()=>[(0,t.Lk)("div",f,[(0,t.Lk)("p",b,[(0,t.bF)(c,{style:{}},{default:(0,t.k6)((()=>[(0,t.bF)(re)])),_:1}),(0,t.eW)("用户名: "+(0,s.v_)(l.value.user_name),1)]),(0,t.Lk)("p",h,[(0,t.bF)(c,null,{default:(0,t.k6)((()=>[(0,t.bF)(ce)])),_:1}),(0,t.eW)("账户余额："+(0,s.v_)(l.value.money)+" ",1),(0,t.Lk)("a",{style:{cursor:"pointer","margin-left":"5%"},onClick:u[4]||(u[4]=e=>N.value=!0)},"点击充值")]),(0,t.Lk)("p",C,[(0,t.bF)(c,null,{default:(0,t.k6)((()=>[(0,t.bF)(ie)])),_:1}),(0,t.eW)("用户类型: 用户")]),null!==l.value.email?((0,t.uX)(),(0,t.CE)("p",F,[(0,t.bF)(c,null,{default:(0,t.k6)((()=>[(0,t.bF)(ke)])),_:1}),(0,t.eW)("邮箱："+(0,s.v_)(l.value.email)+" ",1),(0,t.Lk)("a",{style:{cursor:"pointer","margin-left":"5%"},onClick:ae},"重新绑定邮箱")])):((0,t.uX)(),(0,t.CE)("p",_,[(0,t.bF)(c,null,{default:(0,t.k6)((()=>[(0,t.bF)(ke)])),_:1}),(0,t.eW)("邮箱：暂无 "),(0,t.Lk)("a",{style:{cursor:"pointer","margin-left":"5%"},onClick:ae},"点此设置邮箱")])),(0,t.Lk)("p",w,[(0,t.bF)(c,null,{default:(0,t.k6)((()=>[(0,t.bF)(me)])),_:1}),(0,t.eW)("密码："+(0,s.v_)(B.value)+" ",1),!1===j.value?((0,t.uX)(),(0,t.CE)("div",V,[(0,t.bF)(c,{onClick:ee},{default:(0,t.k6)((()=>[(0,t.bF)(ve)])),_:1})])):(0,t.Q3)("",!0),!0===j.value?((0,t.uX)(),(0,t.CE)("div",L,[(0,t.bF)(c,{onClick:le},{default:(0,t.k6)((()=>[(0,t.bF)(pe)])),_:1})])):(0,t.Q3)("",!0)]),(0,t.bF)(de,{modelValue:z.value,"onUpdate:modelValue":u[8]||(u[8]=e=>z.value=e),title:"设置邮箱",width:"500","align-center":""},{footer:(0,t.k6)((()=>[(0,t.bF)(ne,{type:"default",onClick:u[7]||(u[7]=e=>z.value=!1)},{default:(0,t.k6)((()=>[(0,t.eW)("点击返回")])),_:1}),(0,t.bF)(ne,{type:"primary",onClick:oe},{default:(0,t.k6)((()=>[(0,t.eW)("绑定邮箱")])),_:1})])),default:(0,t.k6)((()=>[(0,t.Lk)("div",A,[(0,t.bF)(ge,{modelValue:M.value,"onUpdate:modelValue":u[5]||(u[5]=e=>M.value=e),placeholder:"请输入邮箱",style:{width:"73%"}},null,8,["modelValue"])]),(0,t.Lk)("div",R,[(0,t.bF)(ge,{modelValue:X.value,"onUpdate:modelValue":u[6]||(u[6]=e=>X.value=e),placeholder:"请输入验证码",style:{width:"40%"}},null,8,["modelValue"]),(0,t.bF)(ne,{style:{"margin-left":"5%"},disabled:q.value,onClick:te},{default:(0,t.k6)((()=>[(0,t.eW)((0,s.v_)(S.value),1)])),_:1},8,["disabled"])])])),_:1},8,["modelValue"])])])),_:1}),(0,t.bF)(ye,{class:"userCard"},{header:(0,t.k6)((()=>[U])),default:(0,t.k6)((()=>[(0,t.Lk)("div",W,[(0,t.Lk)("p",{class:"card-term",style:{color:"red",cursor:"pointer"},onClick:u[9]||(u[9]=e=>H.value=!0)},"修改密码"),(0,t.Lk)("p",{class:"card-term",style:{color:"red",cursor:"pointer"},onClick:u[10]||(u[10]=e=>D.value=!0)},"退出登录"),(0,t.bF)(de,{title:"退出登录",modelValue:D.value,"onUpdate:modelValue":u[12]||(u[12]=e=>D.value=e)},{footer:(0,t.k6)((()=>[(0,t.bF)(ne,{type:"primary",onClick:u[11]||(u[11]=e=>D.value=!1)},{default:(0,t.k6)((()=>[(0,t.eW)("返回")])),_:1}),(0,t.bF)(ne,{type:"default",onClick:P},{default:(0,t.k6)((()=>[(0,t.eW)("退出登录")])),_:1})])),default:(0,t.k6)((()=>[(0,t.eW)(" 您确定要退出登录吗？ ")])),_:1},8,["modelValue"]),(0,t.bF)(de,{modelValue:N.value,"onUpdate:modelValue":u[15]||(u[15]=e=>N.value=e),title:"支付界面"},{footer:(0,t.k6)((()=>[(0,t.bF)(ne,{type:"primary",onClick:u[14]||(u[14]=e=>N.value=!1)},{default:(0,t.k6)((()=>[(0,t.eW)("返回")])),_:1}),(0,t.bF)(ne,{type:"default",onClick:Y},{default:(0,t.k6)((()=>[(0,t.eW)("点击支付")])),_:1})])),default:(0,t.k6)((()=>[I,(0,t.eW)(),(0,t.bF)(ge,{modelValue:$.value,"onUpdate:modelValue":u[13]||(u[13]=e=>$.value=e),placeholder:"请输入充值金额"},null,8,["modelValue"])])),_:1},8,["modelValue"]),(0,t.bF)(de,{title:"修改密码",modelValue:H.value,"onUpdate:modelValue":u[21]||(u[21]=e=>H.value=e),width:"500"},{footer:(0,t.k6)((()=>[(0,t.bF)(ne,{type:"primary",onClick:u[20]||(u[20]=e=>H.value=!1)},{default:(0,t.k6)((()=>[(0,t.eW)("返回")])),_:1}),(0,t.bF)(ne,{type:"default",onClick:Z},{default:(0,t.k6)((()=>[(0,t.eW)("确认修改")])),_:1})])),default:(0,t.k6)((()=>[(0,t.Lk)("div",K,[(0,t.bF)(ge,{placeholder:"请输入邮箱",modelValue:Q.value,"onUpdate:modelValue":u[16]||(u[16]=e=>Q.value=e),style:{width:"73%"}},null,8,["modelValue"])]),(0,t.Lk)("div",x,[(0,t.bF)(ge,{modelValue:O.value,"onUpdate:modelValue":u[17]||(u[17]=e=>O.value=e),placeholder:"请输入验证码",style:{width:"40%"}},null,8,["modelValue"]),(0,t.bF)(ne,{style:{"margin-left":"5%"},disabled:q.value,onClick:te},{default:(0,t.k6)((()=>[(0,t.eW)((0,s.v_)(S.value),1)])),_:1},8,["disabled"])]),(0,t.Lk)("div",T,[(0,t.bF)(ge,{placeholder:"请输入新密码",modelValue:G.value,"onUpdate:modelValue":u[18]||(u[18]=e=>G.value=e),style:{width:"73%"}},null,8,["modelValue"])]),(0,t.Lk)("div",E,[(0,t.bF)(ge,{placeholder:"请再次输入新密码",modelValue:J.value,"onUpdate:modelValue":u[19]||(u[19]=e=>J.value=e),style:{width:"73%"}},null,8,["modelValue"])])])),_:1},8,["modelValue"])])])),_:1})])])])),_:1})}}};const X=M;var N=X}}]);
//# sourceMappingURL=482.1b73de12.js.map