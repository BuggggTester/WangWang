{"version":3,"file":"js/840.63b0dd77.js","mappings":"qGAAO,SAASA,EAAUC,EAAMC,EAAOC,GACnC,MAAMC,EAAI,IAAIC,KACdD,EAAEE,QAAQF,EAAEG,UAAoB,GAAPJ,EAAY,GAAK,GAAK,KAC/C,MAAMK,EAAU,WAAaJ,EAAEK,cAC/BC,SAASC,OAASV,EAAO,IAAMC,EAAQ,IAAMM,EAAU,SAC3D,CAIO,SAASI,EAAUX,GACtB,MAAMY,EAAaZ,EAAO,IACpBa,EAAgBC,mBAAmBL,SAASC,QAC5CK,EAAcF,EAAcG,MAAM,KACxC,IAAK,IAAIC,EAAI,EAAGA,EAAIF,EAAYG,OAAQD,IAAK,CACzC,IAAIP,EAASK,EAAYE,GACzB,MAA4B,MAArBP,EAAOS,OAAO,GACjBT,EAASA,EAAOU,UAAU,GAE9B,GAAmC,IAA/BV,EAAOW,QAAQT,GACf,OAAOF,EAAOU,UAAUR,EAAWM,OAAQR,EAAOQ,OAE1D,CACA,MAAO,EACX,CAIO,SAASI,EAAaV,GACzBH,SAASC,OAASE,EAAa,mDACnC,CACO,SAASW,IACZ,MAAMV,EAAgBC,mBAAmBL,SAASC,QAC5CK,EAAcF,EAAcG,MAAM,KACxC,OAAOD,EAAYG,MACvB,CACA,MACInB,YAAUY,YAAUY,eAAaD,e,qCCvB9BE,eAAeC,EAAcC,EAAMC,EAASC,EAAOC,SAChDC,EAAAA,GAAAA,KAAiB,iBAAkB,CACrCJ,KAAMA,EACNC,QAASA,EACTC,MAAOA,EACPC,KAAMA,GAEd,CAEOL,eAAeO,EAAuBJ,GACzC,MAAMK,QAAYF,EAAAA,GAAAA,IAAgB,6BAA8B,CAC5DH,QAASA,IAGb,OADAM,QAAQC,IAAIF,EAAIG,MACTH,EAAIG,IACf,CACA,MACIV,gBACAM,yB,0sBCrBJ,MAAMK,GAAQC,EAAAA,EAAAA,MACd,IAAIC,GAAQC,EAAAA,EAAAA,IAAI,IACZC,GAASD,EAAAA,EAAAA,IAAI,GACbE,GAAOF,EAAAA,EAAAA,IAAI,GACfN,QAAQC,IAAIE,EAAMM,MAAMC,SACxB,IAAIC,GAAOL,EAAAA,EAAAA,IAAI,KACfM,EAAAA,EAAAA,KAAUrB,UACR,MAAMQ,QAAYF,EAAAA,GAAAA,IAAgB,qBAAsB,CACtD,QAAWM,EAAMM,MAAMC,QACvB,KAAQP,EAAMM,MAAMI,OAEtBR,EAAMrC,MAAQ+B,EAAIG,KAClBG,EAAMrC,MAAM8C,SAAQC,IAClBA,EAAKC,SAAW,CAAC,IAEnBhB,QAAQC,IAAII,EAAMrC,OAClBuC,EAAOvC,MAAQqC,EAAMrC,MAAMiB,OAC3BuB,EAAKxC,MAAQiD,KAAKC,OAAOX,EAAOvC,MAAQ,GAAK,GAAK,EAClD,MAAOuC,EAAOvC,MAAQ,EACpB2C,EAAK3C,MAAMmD,KAAKZ,EAAOvC,MAAQ,EAAIuC,EAAOvC,MAAQ,GAClDuC,EAAOvC,OAAS,EAElBgC,QAAQC,IAAIO,EAAKxC,OACjBgC,QAAQC,IAAIU,EAAK3C,MAAM,IAGzB,MAAMoD,EAAgBC,MAGhBC,GAAwBhB,EAAAA,EAAAA,IAAI,IAC5BiB,GAAgBjB,EAAAA,EAAAA,KAAI,GAEpBkB,EAAajC,UACfgC,EAAcvD,OAAQ,QAChByD,EAAYJ,EAAK,EAErBK,GAAepB,EAAAA,EAAAA,IAAI,IACnBmB,EAAclC,UAElB,MAAMoC,QAAY9B,EAAAA,GAAAA,KAAiB,2BAA4B,CAC7D,QAAW+B,EAAAA,GAAAA,UAAqB,UAChC,QAAUP,EAAKQ,GACf,SAAWR,EAAKL,SAChB,QAAUb,EAAMM,MAAMC,UAElBoB,QAAajC,EAAAA,GAAAA,KAAiB,qBAAqB,CACvD,QAAWwB,EAAKQ,GAChB,QAAWD,EAAAA,GAAAA,UAAqB,UAChC,SAAYP,EAAKL,SACjB,WAAc,aACd,eAAkBW,EAAIzB,KAAK6B,cAC3B,QAAWV,EAAKW,MAAQX,EAAKL,WAE/BU,EAAa1D,MAAQ8D,EAAK5B,KAAK2B,GAC/B7B,QAAQC,IAAIyB,EAAa1D,MAAM,EAG3BiE,EAAe1C,UACnB,GAAkC,IAA/B+B,EAAsBtD,MAKnB,YAJAkE,EAAAA,EAAAA,IAAU,CACNC,QAAS,WACTC,KAAM,YAKhB,MAAMT,QAAY9B,EAAAA,GAAAA,IAAgB,sBAAsB,CACtD,GAAM6B,EAAa1D,QAEpBqE,MAAKC,IAEJtC,QAAQC,IAAIqC,EAASpC,MACrBF,QAAQC,IAAI0B,EAAIzB,KAAK,IAEtBqC,OAAMC,IAELxC,QAAQwC,MAAMA,EAAM,IAEtBN,EAAAA,GAAUO,QAAQ,cACZC,IACNnB,EAAcvD,OAAQ,CAAK,EAGvB2E,EAAcpD,gBAEAM,EAAAA,GAAAA,KAAiB,gBAAiB,CAChD+C,MAAO,aAEVP,MAAKC,IAEJtC,QAAQC,IAAIqC,EAASpC,KAAK,IAE3BqC,OAAMC,IAELxC,QAAQwC,MAAMA,EAAM,IAEtBN,EAAAA,GAAUO,QAAQ,gBACZI,IACNtB,EAAcvD,OAAQ,CAAK,EAGvB0E,EAAiBnD,gBACbuD,EAAAA,GAAAA,cAA0B,OAAQlB,EAAAA,GAAAA,UAAqB,UAAW,UAAW,KAAKzB,EAAMM,MAAMC,sCAAsC,EAGxImC,EAAgBtD,gBACZuD,EAAAA,GAAAA,cAA0B,OAAQlB,EAAAA,GAAAA,UAAqB,UAAW,UAAW,KAAKzB,EAAMM,MAAMC,2CAA2C,EAG7IqC,EAAaA,KACfC,EAAAA,EAAO7B,KAAK,CAAC8B,KAAM,SAAS,E,i1FCnHhC,MAAMC,EAAc,EAEpB,O","sources":["webpack://vue/./src/util/cookie.js","webpack://vue/./src/util/message.js","webpack://vue/./src/views/meal/Meal.vue","webpack://vue/./src/views/meal/Meal.vue?133b"],"sourcesContent":["export function setCookie(name, value, days) {\r\n    const d = new Date();\r\n    d.setTime(d.getTime() + (days * 24 * 60 * 60 * 1000));\r\n    const expires = \"expires=\" + d.toUTCString();\r\n    document.cookie = name + \"=\" + value + \";\" + expires + \";path=/\";\r\n}\r\n/*\r\n设置cookie\r\n */\r\nexport function getCookie(name) {\r\n    const cookieName = name + \"=\";\r\n    const decodedCookie = decodeURIComponent(document.cookie);\r\n    const cookieArray = decodedCookie.split(';');\r\n    for (let i = 0; i < cookieArray.length; i++) {\r\n        let cookie = cookieArray[i];\r\n        while (cookie.charAt(0) === ' ') {\r\n            cookie = cookie.substring(1);\r\n        }\r\n        if (cookie.indexOf(cookieName) === 0) {\r\n            return cookie.substring(cookieName.length, cookie.length);\r\n        }\r\n    }\r\n    return \"\";\r\n}\r\n/*\r\n获取cookie\r\n */\r\nexport function deleteCookie(cookieName) {\r\n    document.cookie = cookieName + '=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/;';\r\n}\r\nexport function getCookieNum(){\r\n    const decodedCookie = decodeURIComponent(document.cookie);\r\n    const cookieArray = decodedCookie.split(';');\r\n    return cookieArray.length;\r\n}\r\nexport default {\r\n    setCookie,getCookie,getCookieNum,deleteCookie\r\n}","import requestUtil from \"@/util/request\"\r\nimport {dayjs} from \"element-plus\";\r\nimport axios from 'axios';\r\n/*\r\n功能：生成消息并推送给指定用户\r\n使用方法：\r\n<script>\r\nimport messageUtil from \"@/util/message\"\r\n\r\nconst _functionname = async (_params) => {\r\n  await messageUtil.createMessage(\"whosend\", userId, \"title\", \"body\")\r\n}\r\n */\r\nexport async function createMessage(send, receive, title, body){\r\n    await requestUtil.post('message/create', {\r\n        send: send,\r\n        receive: receive,\r\n        title: title,\r\n        body: body\r\n    })\r\n}\r\n\r\nexport async function getUnreadMessageNumber(receive){\r\n    const rec = await requestUtil.get('message/unreadnumberselect', {\r\n        receive: receive\r\n    })\r\n    console.log(rec.data)\r\n    return rec.data\r\n}\r\nexport default {\r\n    createMessage,\r\n    getUnreadMessageNumber\r\n}","<script setup>\r\nimport {onMounted, ref} from \"vue\";\r\nimport requestUtil, {getServerUrl} from \"@/util/request\"\r\nimport {inputNumberEmits} from \"element-plus\";\r\nimport { useRoute } from \"vue-router\";\r\nimport {ElMessage} from \"element-plus\";\r\nimport router from \"@/router\";\r\nimport messageUtil from \"@/util/message\"\r\nimport cookieUtil from \"@/util/cookie\"\r\n\r\nconst route = useRoute();\r\nlet foods = ref([])\r\nlet number = ref(0)\r\nlet rows = ref(0)\r\nconsole.log(route.query.trainId);\r\nlet cols = ref([])\r\nonMounted(async () => {\r\n  const rec = await requestUtil.get('food/select/tripId', {\r\n    \"trainId\": route.query.trainId,\r\n    \"time\": route.query.time\r\n  })\r\n  foods.value = rec.data\r\n  foods.value.forEach(item=> {\r\n    item.quantity = 0;\r\n  })\r\n  console.log(foods.value)\r\n  number.value = foods.value.length\r\n  rows.value = Math.floor((number.value - 1) / 3) + 1\r\n  while (number.value > 0){\r\n    cols.value.push(number.value < 3 ? number.value : 3)\r\n    number.value -= 3\r\n  }\r\n  console.log(rows.value)\r\n  console.log(cols.value)\r\n})\r\n\r\nconst handleChange = (food) => {\r\n}\r\n\r\nconst selectedPaymentMethod = ref(\"\");\r\nconst dialogVisible = ref(false);\r\n\r\nconst openDialog = async (food) => {\r\n    dialogVisible.value = true;\r\n    await createOrder(food); // 在打开对话框前执行createOrder\r\n};\r\nconst totalOrderId = ref('');\r\nconst createOrder = async(food) =>{\r\n  // 发送创建食物订单的请求\r\n  const res = await requestUtil.post('/food/create/reservation', {\r\n    \"user_id\": cookieUtil.getCookie(\"userId\"),\r\n    \"food_id\":food.id,\r\n    \"quantity\":food.quantity,\r\n    \"trip_id\":route.query.trainId\r\n  });\r\n  const res2 = await requestUtil.post('/totalorder/create',{\r\n    \"food_id\": food.id,\r\n    \"user_id\": cookieUtil.getCookie(\"userId\"),\r\n    \"quantity\": food.quantity,\r\n    \"order_type\": \"TRAIN_MEAL\",\r\n    \"reservation_id\": res.data.reservationId,\r\n    \"payment\": food.price * food.quantity\r\n  });\r\n  totalOrderId.value = res2.data.id;\r\n  console.log(totalOrderId.value);\r\n}\r\n\r\nconst confirmOrder = async() =>{\r\n  if(selectedPaymentMethod.value == \"\") {\r\n        ElMessage({\r\n            message: \"请选择支付方式！\",\r\n            type: \"warning\"\r\n        });\r\n        return;\r\n    }\r\n  //确认订单\r\n  const res = await requestUtil.get('/totalorder/confirm',{\r\n    \"id\": totalOrderId.value\r\n  })\r\n  .then(response => {\r\n    // 请求成功处理\r\n    console.log(response.data);\r\n    console.log(res.data);\r\n  })\r\n  .catch(error => {\r\n    // 请求失败\r\n    console.error(error);\r\n  });\r\n  ElMessage.success('订餐成功');\r\n  await confirmMessage();\r\n  dialogVisible.value = false;\r\n}\r\n\r\nconst cancelOrder = async() =>{\r\n  //确认订单\r\n  const res = await requestUtil.post('/order/cancel', {\r\n      state: \"canceled\"\r\n  })\r\n  .then(response => {\r\n    // 请求成功处理\r\n    console.log(response.data);\r\n  })\r\n  .catch(error => {\r\n    // 请求失败\r\n    console.error(error);\r\n  });\r\n  ElMessage.success('取消订餐成功');\r\n  await cancelMessage();\r\n  dialogVisible.value = false;\r\n}\r\n\r\nconst confirmMessage = async () => {\r\n    await messageUtil.createMessage(\"汪汪旅途\", cookieUtil.getCookie(\"userId\"), \"火车餐订购成功\", `您的${route.query.trainId}车次的火车餐已购买成功，祝您旅途愉快以及用餐愉快，汪汪~`)\r\n}\r\n\r\nconst cancelMessage = async () => {\r\n    await messageUtil.createMessage(\"汪汪旅途\", cookieUtil.getCookie(\"userId\"), \"火车餐取消成功\", `您的${route.query.trainId}车次的火车餐已取消，您没饭吃了哦，祝您旅途愉快以及各种愉快，汪汪~`)\r\n}\r\n\r\nconst backToMain = () => {\r\n    router.push({path: '/main'});\r\n}\r\n\r\n</script>\r\n\r\n<template>\r\n  <el-page-header :icon=\"ArrowLeft\" @back=\"backToMain\">\r\n    <template #content>\r\n      <p style=\"font-size: 25px; font-family: serif; margin-bottom: 10px\">&nbsp;&nbsp;火车餐购买</p>\r\n    </template>\r\n  </el-page-header>\r\n  <div>\r\n    <el-scrollbar height=\"100%\">\r\n      <el-row v-for=\"i in rows\" :gutter=\"20\" justify=\"space-around\">\r\n        <el-col v-for=\"j in cols[i-1]\" :key=\"j\" :span=\"7\">\r\n          <el-card class=\"card\" shadow=\"always\" :body-style=\"{height:'125px', width:'100%', boxSizing:'border-box'}\">\r\n            <template #header><p style=\"font-size: 20px\">{{ foods[j - 1 + (i-1) * 3].name}}</p></template>\r\n            <el-row :gutter=\"50\">\r\n              <el-col :span=\"10\">\r\n                <img :src=\"getServerUrl() + foods[j - 1 + (i-1) * 3].picture_path\" width=\"170\"/>\r\n              </el-col>\r\n              <el-col :span=\"13\">\r\n                <p style=\"color: #6b778c\">{{ foods[j - 1 + (i-1) * 3].description}}</p>\r\n              </el-col>\r\n            </el-row>\r\n            <template #footer class=\".el-card__footer\">\r\n              <el-row :gutter=\"15\">\r\n                <el-col :span=\"6\"><p style=\"font-size: 20px; margin-top: 5px; color: #ff8800\" type=\"flex\" >￥{{ foods[j - 1 + (i-1) * 3].price}}</p></el-col>\r\n                <el-col :span=\"8\"><el-input-number  v-model=\"foods[j - 1 + (i-1) * 3].quantity\" :min=\"1\" :max=\"10\" @change=\"handleChange(foods[j - 1 + (i-1) * 3])\" /></el-col>\r\n                <el-col :span=\"10\"><el-button type=\"primary\" plain class=\"button\" @click=\"openDialog(foods[j - 1 + (i-1) * 3])\">立即购买</el-button></el-col>\r\n              </el-row>\r\n            </template>\r\n          </el-card>\r\n        </el-col>\r\n      </el-row>\r\n    </el-scrollbar>\r\n  </div>\r\n\r\n  <el-dialog v-model=\"dialogVisible\">\r\n    <el-card>\r\n        <span style=\"font-size: larger\">请选择支付方式:  </span>\r\n        <div class=\"component\">\r\n          <hr>\r\n        </div>\r\n        <el-radio-group v-model=\"selectedPaymentMethod\">\r\n\r\n          <el-radio-button label=\"wechat\">\r\n            <i class=\"icon-wechat\"></i>\r\n          </el-radio-button>\r\n          <el-radio-button label=\"alipay\">\r\n            <i class=\"icon-alipay\"></i>\r\n          </el-radio-button>\r\n          <el-radio-button label=\"bank\">\r\n            <i class=\"icon-bank\"></i>\r\n          </el-radio-button>\r\n        </el-radio-group>\r\n\r\n        <el-button @click=\"confirmOrder\" type=\"primary\" style=\"margin-left:15%;margin-top:10px;height:40px;width:200px\">确认支付\r\n        </el-button>\r\n        <el-button @click=\"cancelOrder\" style=\"margin-left:20%;margin-top:10px;height:40px;width:200px\">取消订单\r\n        </el-button>\r\n    </el-card>\r\n  </el-dialog>\r\n\r\n</template>\r\n\r\n<style>\r\n.scrollbar-demo-item {\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  height: 50px;\r\n  margin: 10px;\r\n  text-align: center;\r\n  border-radius: 4px;\r\n  background: var(--el-color-primary-light-9);\r\n  color: var(--el-color-primary);\r\n}\r\n.card{\r\n  width: 100%;\r\n  height: 240px;\r\n  margin: 10px;\r\n}\r\np{\r\n  word-wrap: break-word;\r\n  word-break: break-all;\r\n}\r\nbutton{\r\n  margin-left: 50%;\r\n}\r\n.el-card__footer {\r\n  border-top: 1px solid var(--el-card-border-color);\r\n  box-sizing: border-box;\r\n  padding: calc(var(--el-card-padding) - 8px) var(--el-card-padding);\r\n}\r\n.icon-wechat {\r\n  background-image: url('~@/assets/images/payMethod/wechat.png'); /* 使用webpack的别名指向图片路径 */\r\n  background-size: contain; /* 调整图片尺寸 */\r\n  background-repeat: no-repeat; /* 禁止背景图片重复 */\r\n  width: 160px; /* 设置图标宽度 */\r\n  height: 200px; /* 设置图标高度 */\r\n  display: inline-block; /* 将图标设置为行内块元素 */\r\n}\r\n\r\n.icon-alipay {\r\n  background-image: url('~@/assets/images/payMethod/alipay.png');\r\n  background-size: contain;\r\n  background-repeat: no-repeat;\r\n  width: 160px;\r\n  height: 200px;\r\n  display: inline-block;\r\n}\r\n\r\n.icon-bank {\r\n  background-image: url('~@/assets/images/payMethod/bank.png');\r\n  background-size: contain;\r\n  background-repeat: no-repeat;\r\n  width: 160px;\r\n  height: 200px;\r\n  display: inline-block;\r\n}\r\n</style>","import script from \"./Meal.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./Meal.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./Meal.vue?vue&type=style&index=0&id=c941d3fa&lang=css\"\n\nconst __exports__ = script;\n\nexport default __exports__"],"names":["setCookie","name","value","days","d","Date","setTime","getTime","expires","toUTCString","document","cookie","getCookie","cookieName","decodedCookie","decodeURIComponent","cookieArray","split","i","length","charAt","substring","indexOf","deleteCookie","getCookieNum","async","createMessage","send","receive","title","body","requestUtil","getUnreadMessageNumber","rec","console","log","data","route","useRoute","foods","ref","number","rows","query","trainId","cols","onMounted","time","forEach","item","quantity","Math","floor","push","handleChange","food","selectedPaymentMethod","dialogVisible","openDialog","createOrder","totalOrderId","res","cookieUtil","id","res2","reservationId","price","confirmOrder","ElMessage","message","type","then","response","catch","error","success","confirmMessage","cancelOrder","state","cancelMessage","messageUtil","backToMain","router","path","__exports__"],"sourceRoot":""}