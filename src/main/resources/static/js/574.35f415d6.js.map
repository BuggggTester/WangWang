{"version":3,"file":"js/574.35f415d6.js","mappings":"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","sources":["webpack://vue/./node_modules/vue-loader/dist/exportHelper.js","webpack://vue/./src/util/cookie.js","webpack://vue/./src/util/message.js","webpack://vue/./src/views/Message.vue","webpack://vue/./src/views/Message.vue?c49a"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\n// runtime helper for setting properties on components\n// in a tree-shakable way\nexports.default = (sfc, props) => {\n    const target = sfc.__vccOpts || sfc;\n    for (const [key, val] of props) {\n        target[key] = val;\n    }\n    return target;\n};\n","export function setCookie(name, value, days) {\r\n    const d = new Date();\r\n    d.setTime(d.getTime() + (days * 24 * 60 * 60 * 1000));\r\n    const expires = \"expires=\" + d.toUTCString();\r\n    document.cookie = name + \"=\" + value + \";\" + expires + \";path=/\";\r\n}\r\n/*\r\n设置cookie\r\n */\r\nexport function getCookie(name) {\r\n    const cookieName = name + \"=\";\r\n    const decodedCookie = decodeURIComponent(document.cookie);\r\n    const cookieArray = decodedCookie.split(';');\r\n    for (let i = 0; i < cookieArray.length; i++) {\r\n        let cookie = cookieArray[i];\r\n        while (cookie.charAt(0) === ' ') {\r\n            cookie = cookie.substring(1);\r\n        }\r\n        if (cookie.indexOf(cookieName) === 0) {\r\n            return cookie.substring(cookieName.length, cookie.length);\r\n        }\r\n    }\r\n    return \"\";\r\n}\r\n/*\r\n获取cookie\r\n */\r\nexport function deleteCookie(cookieName) {\r\n    document.cookie = cookieName + '=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/;';\r\n}\r\nexport function getCookieNum(){\r\n    const decodedCookie = decodeURIComponent(document.cookie);\r\n    const cookieArray = decodedCookie.split(';');\r\n    return cookieArray.length;\r\n}\r\nexport default {\r\n    setCookie,getCookie,getCookieNum,deleteCookie\r\n}","import requestUtil from \"@/util/request\"\r\nimport {dayjs} from \"element-plus\";\r\nimport axios from 'axios';\r\n/*\r\n功能：生成消息并推送给指定用户\r\n使用方法：\r\n<script>\r\nimport messageUtil from \"@/util/message\"\r\n\r\nconst _functionname = async (_params) => {\r\n  await messageUtil.createMessage(\"whosend\", userId, \"title\", \"body\")\r\n}\r\n */\r\nexport async function createMessage(send, receive, title, body){\r\n    await requestUtil.post('message/create', {\r\n        send: send,\r\n        receive: receive,\r\n        title: title,\r\n        body: body\r\n    })\r\n}\r\n\r\nexport async function getUnreadMessageNumber(receive){\r\n    const rec = await requestUtil.get('message/unreadnumberselect', {\r\n        receive: receive\r\n    })\r\n    console.log(rec.data)\r\n    return rec.data\r\n}\r\nexport default {\r\n    createMessage,\r\n    getUnreadMessageNumber\r\n}","<script setup>\r\nimport {nextTick, onMounted, ref} from \"vue\"\r\nimport requestUtil from \"@/util/request\"\r\nimport cookieUtil from \"@/util/cookie\"\r\nimport messageUtil from \"@/util/message\"\r\nimport index from \"vuex\";\r\nlet messages = ref([])\r\n\r\nconst onlyunread = ref(false)\r\nlet dialogVisible = ref([])\r\nconst pick_date = ref('')\r\nconst size = ref('default')\r\nconst count = ref(0)\r\nlet unreadmessages = ref([])\r\nconst load = () => {\r\n  count.value += 10\r\n}\r\nconst setRead = async (message) => {\r\n  console.log(\"set\")\r\n\r\n  await requestUtil.put('/message/setread', {\r\n    message_id: message.message_id\r\n  })\r\n  let i = messages.value.indexOf(message)\r\n  messages.value[i].ifread = true\r\n}\r\nconst resetDialogState = (messages) => {\r\n  dialogVisible = ref([])\r\n  let number = messages.value.length\r\n  for(let i = 0; i < number; i ++){\r\n    dialogVisible.value.push(false)\r\n  }\r\n}\r\nconst setAllRead = async () =>{\r\n  const rec = await requestUtil.get('message/unreadselect', {\r\n    receive: cookieUtil.getCookie(\"userId\")\r\n  })\r\n  unreadmessages.value = rec.data;\r\n  const num = unreadmessages.value.length\r\n  for(var i = 0; i < num; i ++){\r\n    // console.log(unreadmessages.value[i]);\r\n    await requestUtil.put('/message/setread', {\r\n      message_id: unreadmessages.value[i].message_id\r\n    })\r\n  }\r\n  await getAllMessages()\r\n}\r\nconst getAllMessages = async () => {\r\n  const rec = await requestUtil.get('message/baseselect',{\r\n    receive: cookieUtil.getCookie(\"userId\")\r\n  })\r\n  messages.value = rec.data\r\n  console.log(messages.value)\r\n}\r\nconst getUnreadMessages = async () => {\r\n  const rec = await requestUtil.get('message/unreadselect',{\r\n    receive: cookieUtil.getCookie(\"userId\")\r\n  })\r\n  messages.value = rec.data\r\n}\r\nconst getMessagesByDate = async () => {\r\n  const rec = await requestUtil.get('message/dateselect', {\r\n    receive: cookieUtil.getCookie(\"userId\"),\r\n    send_date: pick_date.value\r\n  })\r\n  messages.value = rec.data\r\n}\r\nconst getUnreadMessagesByDate = async () => {\r\n  const rec = await requestUtil.get('message/unreaddateselect', {\r\n    receive: cookieUtil.getCookie(\"userId\"),\r\n    send_date: pick_date.value\r\n  })\r\n  messages.value = rec.data\r\n}\r\nconst catchChange = async () => {\r\n  console.log(pick_date.value)\r\n  console.log(onlyunread.value)\r\n  if(pick_date.value === \"\" || pick_date.value == null){\r\n    if(!onlyunread.value){\r\n      await getAllMessages()\r\n    }else{\r\n      await getUnreadMessages()\r\n    }\r\n  }else{\r\n    if(!onlyunread.value){\r\n      await getMessagesByDate()\r\n    }else{\r\n      await getUnreadMessagesByDate()\r\n    }\r\n  }\r\n  resetDialogState(messages)\r\n}\r\nconst createTest = async () => {\r\n  await messageUtil.createMessage(\"Crow_D\", cookieUtil.getCookie(\"userId\"), \"推送测试\", \"test\")\r\n}\r\nonMounted( async () => {\r\n  await getAllMessages()\r\n})\r\n</script>\r\n\r\n<template>\r\n  <el-card style=\"padding-left: 5%; padding-right: 5%\">\r\n    <template #header>\r\n    <el-page-header  @back=\"goBack\">\r\n      <template #content>\r\n        <span style=\"font-size: larger; font-weight: 600; margin-right: 3%; white-space: nowrap;\">消息中心</span>\r\n      </template>\r\n    </el-page-header>\r\n    </template>\r\n    <el-row justify=\"space-between\">\r\n      <el-col :span=\"3\"><el-button style=\"font-family: 'Microsoft Yahei'\" @click=\"setAllRead\">全部设为已读</el-button></el-col>\r\n      <el-col :span=\"3\"><el-checkbox v-model=\"onlyunread\" @change=\"catchChange\">只看未读消息</el-checkbox></el-col>\r\n      <el-col :span=\"7\">\r\n        <div>\r\n        <el-date-picker\r\n          v-model=\"pick_date\"\r\n          type=\"date\"\r\n          format=\"YYYY-MM-DD\"\r\n          value-format=\"YYYY-MM-DD\"\r\n          placeholder=\"选择消息接收截止日期\"\r\n          @change=\"catchChange\"\r\n        />\r\n        </div>\r\n      </el-col>\r\n    </el-row>\r\n    <el-divider border-style=\"hidden\" style=\"margin: 10px\"/>\r\n      <el-row justify=\"space-around\">\r\n        <el-col :span=\"6\"><p>标题</p></el-col>\r\n        <el-col :span=\"4\"><p>日期</p></el-col>\r\n        <el-col :span=\"3\"><p>发送者</p></el-col>\r\n        <el-col :span=\"2\"><p>状态</p></el-col>\r\n      </el-row>\r\n    <el-divider style=\"margin: 5px\"/>\r\n    <ul v-infinite-scroll=\"load\" style=\"overflow: auto\">\r\n      <li v-for=\"message in messages\" class=\"infinite-list-item\">\r\n        <div :class=\"[message.ifread ? 'message-row-read' : 'message-row-unread']\" @click=\"dialogVisible[messages.indexOf(message)] = true; setRead(message)\">\r\n          <el-row justify=\"space-around\" class=\"message-row\">\r\n            <el-col :span=\"6\">\r\n              <p>\r\n                {{ message.title }}\r\n              </p>\r\n              <el-dialog\r\n                  v-model=\"dialogVisible[messages.indexOf(message)]\"\r\n                  :title=\"message.title\"\r\n                  width=\"500\"\r\n              >\r\n                <div class=\"mainbody\">{{ message.body }}</div>\r\n                <div class=\"foot\">发送时间：{{message.send_date}} {{ message.send_time }}</div>\r\n              </el-dialog>\r\n            </el-col>\r\n            <el-col :span=\"5\"><p>&emsp;&emsp;{{message.send_date}}</p></el-col>\r\n            <el-col :span=\"4\"><p>&emsp;&emsp;{{message.send}}</p></el-col>\r\n            <el-col :span=\"2\" v-if=\"message.ifread === true\"><p>已读</p></el-col>\r\n            <el-col :span=\"2\" v-else><p>未读</p></el-col>\r\n          </el-row>\r\n        </div>\r\n        <el-divider class=\"divider\"/>\r\n      </li>\r\n    </ul>\r\n    <el-button @click=\"createTest\">press to create a message</el-button>\r\n  </el-card>\r\n</template>\r\n\r\n<style scoped>\r\n.header{\r\n  font-family: \"Microsoft Yahei\" !important;\r\n  font-size: 30px;\r\n}\r\n.infinite-list {\r\n  height: 54px;\r\n  padding: 0;\r\n  margin: 0;\r\n  list-style: none;\r\n}\r\n.infinite-list .infinite-list-item {\r\n  display: flex;\r\n  justify-content: center;\r\n  height: 50px;\r\n  margin: 10px;\r\n}\r\n.infinite-list .infinite-list-item + .list-item {\r\n  margin-top: 10px;\r\n}\r\n.message-row{\r\n  margin-top: 3px;\r\n  margin-bottom: 6px;\r\n}\r\n.message-row-unread {\r\n  background-color: rgba(137, 193, 246, 0.44);\r\n  border-radius:10px;\r\n  margin-top: 5px;\r\n  height: 30px !important;\r\n  overflow:hidden !important;\r\n  align-items: center;\r\n}\r\n.message-row-read {\r\n  border-radius:50px;\r\n  margin-top: 5px;\r\n  height: 30px !important;\r\n  overflow:hidden !important\r\n}\r\n.divider{\r\n  margin-top: 5px;\r\n  margin-bottom: 0px;\r\n  border-bottom: 10px;\r\n}\r\n.mainbody{\r\n  font-family: Arial, \"Microsoft Yahei\", \"Helvetica Neue\", Helvetica, sans-serif;\r\n  font-size: 16px;\r\n  width: 100%;\r\n  line-height: 24px;\r\n}\r\n.foot{\r\n  color: #8c939d;\r\n  width: 100%;\r\n  margin-top: 20px;\r\n}\r\np{\r\n  margin-top: 6px;\r\n}\r\nbutton{\r\n  margin-top: 0px;\r\n}\r\n</style>","import script from \"./Message.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./Message.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./Message.vue?vue&type=style&index=0&id=949b4870&scoped=true&lang=css\"\n\nimport exportComponent from \"../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-949b4870\"]])\n\nexport default __exports__"],"names":["exports","sfc","props","target","__vccOpts","key","val","setCookie","name","value","days","d","Date","setTime","getTime","expires","toUTCString","document","cookie","getCookie","cookieName","decodedCookie","decodeURIComponent","cookieArray","split","i","length","charAt","substring","indexOf","deleteCookie","getCookieNum","async","createMessage","send","receive","title","body","requestUtil","getUnreadMessageNumber","rec","console","log","data","messages","ref","onlyunread","dialogVisible","pick_date","count","unreadmessages","load","setRead","message_id","message","ifread","resetDialogState","number","push","setAllRead","cookieUtil","num","getAllMessages","getUnreadMessages","getMessagesByDate","send_date","getUnreadMessagesByDate","catchChange","createTest","messageUtil","onMounted","__exports__"],"sourceRoot":""}